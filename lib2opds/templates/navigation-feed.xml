<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>urn:uuid:{{ feed.id }}</id>
  <link rel="self" href="{{ feed.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind=acquisition"/>
  {% if feed.root %}
  <link rel="start" href="{{ feed.root.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind=navigation"/>
  {% endif %}
  {% if feed.parent %}
  <link rel="up" href="{{ feed.parent.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind=navigation"/>
  {% endif %}

  <title>{{ feed.get_title() }}</title>
  <updated>{{ feed.updated }}</updated>
  <author>
    <name>lib2opds generator</name>
    <uri>http://opds-spec.org</uri>
  </author>
  {% if feed.is_root() %}
  {% for entry in feed.entries %}
  <entry>
    {% if entry.kind == "acquisition" %}
    <title>{{ entry.get_title() }} ({{ entry.publications | count }})</title>
    {% else %}
    <title>{{ entry.get_title() }}</title>
    {% endif %}
    <link rel="subsection" href="{{ entry.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind={{ entry.kind }}"/>
    <updated>{{ entry.updated }}</updated>
    <id>urn:uuid:{{ entry.id }}</id>
  </entry>
  {% endfor %}
  {% else %}
  {% for entry in feed.entries | sort(attribute="title") %}
  <entry>
    {% if entry.kind == "acquisition" %}
    <title>{{ entry.get_title() }} ({{ entry.publications | count }})</title>
    {% else %}
    <title>{{ entry.get_title() }}</title>
    {% endif %}
    <link rel="subsection" href="{{ entry.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind={{ entry.kind }}"/>
    <updated>{{ entry.updated }}</updated>
    <id>urn:uuid:{{ entry.id }}</id>
  </entry>
  {% endfor %}
  {% endif %}
</feed>
