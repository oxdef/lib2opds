<?xml version="1.0" encoding="UTF-8"?>
{% if feed.config.generate_site_xslt %}
<?xml-stylesheet href="{{ feed.config.get_assets_uri() }}/navigation-feed.xsl" type="text/xsl"?>
{% endif %}
<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
  <atom:id>urn:uuid:{{ feed.id }}</atom:id>
  <atom:link rel="self" href="{{ feed.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind=acquisition"/>
  {% if feed.root %}
  <atom:link rel="start" href="{{ feed.root.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind=navigation"/>
  {% endif %}
  {% if feed.parent %}
  <atom:link rel="up" href="{{ feed.parent.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind=navigation"/>
  {% endif %}
  <atom:title>{{ feed.get_title() }}</atom:title>
  <atom:updated>{{ feed.updated }}</atom:updated>
  <atom:author>
    <atom:name>lib2opds generator</atom:name>
    <atom:uri>http://opds-spec.org</atom:uri>
  </atom:author>
  {% if feed.is_root() %}
  {% for entry in feed.entries %}
  <atom:entry>
    {% if entry.kind == "acquisition" %}
    <atom:title>{{ entry.get_title() }} ({{ entry.publications | count }})</atom:title>
    {% else %}
    <atom:title>{{ entry.get_title() }}</atom:title>
    {% endif %}
    <atom:link rel="subsection" href="{{ entry.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind={{ entry.kind }}"/>
    <atom:updated>{{ entry.updated }}</atom:updated>
    <atom:id>urn:uuid:{{ entry.id }}</atom:id>
  </atom:entry>
  {% endfor %}
  {% else %}
  {% for entry in feed.entries | sort(attribute="title") %}
  <atom:entry>
    {% if entry.kind == "acquisition" %}
    <atom:title>{{ entry.get_title() }} ({{ entry.publications | count }})</atom:title>
    {% else %}
    <atom:title>{{ entry.get_title() }}</atom:title>
    {% endif %}
    <atom:link rel="subsection" href="{{ entry.get_link_self_href_xml() }}" type="application/atom+xml;profile=opds-catalog;kind={{ entry.kind }}"/>
    <atom:updated>{{ entry.updated }}</atom:updated>
    <atom:id>urn:uuid:{{ entry.id }}</atom:id>
  </atom:entry>
  {% endfor %}
  {% endif %}
</atom:feed>
